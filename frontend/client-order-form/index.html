<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AXKAN - Souvenirs Personalizados</title>
    <link rel="icon" type="image/png" href="/assets/images/LOGO-01.png">
    <link rel="stylesheet" href="/client-order-form/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">

        <!-- STEP 1: Login/Account -->
        <section id="step-login" class="step active">
            <div class="progress-bar">
                <div class="progress" style="width: 5%"></div>
            </div>
            <div class="step-indicator">Paso 1 de 4</div>

            <div class="header">
                <div class="logo">
                    <img src="/assets/images/LOGO-03.png" alt="AXKAN Logo">
                </div>
                <h1>Souvenirs Personalizados</h1>
                <p class="subtitle">Imanes, Llaveros, Destapadores, Botones y m√°s</p>
            </div>

            <!-- #2: Deposit explanation upfront -->
            <div class="deposit-info-banner">
                <div class="deposit-info-icon">üí∞</div>
                <div class="deposit-info-text">
                    <strong>¬øC√≥mo funciona?</strong>
                    <p>Pagas 50% de anticipo al hacer tu pedido y el resto cuando est√© listo para enviarse</p>
                </div>
            </div>

            <div class="card">
                <h2>Bienvenido</h2>
                <p class="help-text">Ingresa tu tel√©fono y correo para comenzar</p>
                <p class="required-legend">* Campo requerido</p>

                <!-- Returning client welcome message (hidden by default, shown via JS) -->
                <div id="returning-client-banner" class="returning-client-banner" style="display: none;">
                    <div class="returning-icon">üëã</div>
                    <div class="returning-text">
                        <strong>¬°Bienvenido de nuevo, <span id="returning-client-name"></span>!</strong>
                        <p>Tu informaci√≥n est√° guardada</p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="phone">N√∫mero de Tel√©fono *</label>
                    <input type="tel"
                           id="phone"
                           placeholder="5512345678"
                           maxlength="10"
                           pattern="[0-9]{10}"
                           autocomplete="tel"
                           aria-describedby="phone-hint phone-error"
                           required>
                    <span class="input-hint" id="phone-hint">10 d√≠gitos, sin espacios</span>
                    <span class="input-error" id="phone-error" role="alert"></span>
                </div>

                <div class="form-group">
                    <label for="login-email">Correo Electr√≥nico *</label>
                    <input type="email"
                           id="login-email"
                           placeholder="tucorreo@ejemplo.com"
                           autocomplete="email"
                           aria-describedby="email-hint email-error"
                           required>
                    <span class="input-hint" id="email-hint">Usaremos este correo para confirmar tu pedido</span>
                    <span class="input-error" id="email-error" role="alert"></span>
                </div>

                <button id="continue-phone" class="btn btn-primary btn-large">
                    Ver Productos ‚Üí
                </button>

                <div style="text-align: center; margin-top: 16px;">
                    <button id="btn-lookup-orders" class="btn-text-link">
                        üì¶ ¬øYa hiciste un pedido? <span style="text-decoration: underline;">Rastrear pedido</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- STEP 1.5: Confirm Client Data (for returning clients) -->
        <section id="step-confirm" class="step">
            <div class="progress-bar">
                <div class="progress" style="width: 20%"></div>
            </div>

            <button class="btn-back" onclick="goBack()">‚Üê Atr√°s</button>

            <div class="card">
                <h2>Confirma tus Datos</h2>
                <p class="help-text">¬øLa informaci√≥n que se muestra aqu√≠ corresponde con tus datos?</p>

                <div class="info-box info-box-blue">
                    <div class="icon">üì¶</div>
                    <div>
                        <strong>Esta informaci√≥n ser√° usada para enviar tu pedido</strong>
                        <p>Aseg√∫rate que todo est√© correcto antes de continuar</p>
                    </div>
                </div>

                <div id="confirm-data-display" style="background: var(--gray-50); padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <!-- Data will be populated by JavaScript -->
                </div>

                <div style="display: flex; gap: 12px;">
                    <button id="edit-data-btn" class="btn btn-secondary" style="flex: 1;" onclick="editClientData()">
                        ‚úèÔ∏è Modificar Datos
                    </button>
                    <button id="confirm-data-btn" class="btn btn-primary" style="flex: 2;">
                        ‚úÖ Datos Correctos, Continuar
                    </button>
                </div>
            </div>
        </section>

        <!-- STEP 2: Client Info (for new clients or edit) -->
        <section id="step-info" class="step">
            <div class="progress-bar">
                <div class="progress" style="width: 25%"></div>
            </div>
            <div class="step-indicator">Paso 2 de 4</div>

            <button class="btn-back" onclick="goBack()" aria-label="Volver al paso anterior">‚Üê Atr√°s</button>

            <div class="card">
                <h2>Tus Datos</h2>
                <p class="help-text" id="info-help-text">Completa tu informaci√≥n</p>
                <p class="required-legend">* Campo requerido</p>

                <div class="form-group">
                    <label for="client-name">Nombre Completo *</label>
                    <input type="text"
                           id="client-name"
                           placeholder="Mar√≠a Gonz√°lez"
                           autocomplete="name"
                           aria-describedby="client-name-error"
                           required>
                    <span class="input-error" id="client-name-error" role="alert"></span>
                </div>

                <!-- Email removed - already captured in Step 1 -->
                <input type="hidden" id="client-email">

                <!-- Delivery Address Warning -->
                <div class="info-box info-box-warning">
                    <div class="icon">üì¶</div>
                    <div>
                        <strong>Informaci√≥n de Env√≠o</strong>
                        <p>Esta direcci√≥n ser√° usada para enviar tu pedido. <strong>Aseg√∫rate de que todos los datos sean correctos</strong>, de lo contrario tu paquete no llegar√° a su destino.</p>
                    </div>
                </div>

                <!-- Postal Code FIRST - auto-fills state, city, colonia -->
                <div class="form-group">
                    <label for="client-postal">C√≥digo Postal *</label>
                    <input type="text"
                           id="client-postal"
                           placeholder="Ej: 03100"
                           maxlength="5"
                           pattern="[0-9]{5}"
                           autocomplete="postal-code"
                           inputmode="numeric"
                           required>
                    <span class="input-hint">üìç Ingresa 5 d√≠gitos para llenar autom√°ticamente estado, ciudad y colonia</span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="client-state">Estado *</label>
                        <input type="text"
                               id="client-state"
                               placeholder="Se llenar√° autom√°ticamente"
                               autocomplete="address-level1"
                               required>
                    </div>
                    <div class="form-group">
                        <label for="client-city">Ciudad/Municipio *</label>
                        <input type="text"
                               id="client-city"
                               placeholder="Se llenar√° autom√°ticamente"
                               autocomplete="address-level2"
                               required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="client-colonia">Colonia *</label>
                    <div id="colonia-container">
                        <input type="text"
                               id="client-colonia"
                               placeholder="Se llenar√° autom√°ticamente"
                               required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <label for="client-street">Calle *</label>
                        <input type="text"
                               id="client-street"
                               placeholder="Ej: Av. Insurgentes Sur"
                               autocomplete="address-line1"
                               required>
                        <span class="input-hint">Nombre de la calle</span>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="client-street-number">N√∫mero *</label>
                        <input type="text"
                               id="client-street-number"
                               placeholder="Ej: 1234 int 5"
                               required>
                        <span class="input-hint">Exterior e interior</span>
                    </div>
                </div>
                <!-- Keep hidden client-address for backward compatibility -->
                <input type="hidden" id="client-address">

                <div class="form-group">
                    <label for="client-references">Referencias de Ubicaci√≥n (opcional)</label>
                    <textarea id="client-references"
                              rows="2"
                              maxlength="150"
                              aria-describedby="references-counter"
                              placeholder="Ej: Entre calle X y Y, edificio azul, port√≥n negro"></textarea>
                    <span class="input-hint" id="references-counter">0/150 caracteres</span>
                </div>

                <button id="continue-info" class="btn btn-primary btn-large">
                    Elegir Productos ‚Üí
                </button>
            </div>
        </section>

        <!-- STEP 3: Product Selection -->
        <section id="step-products" class="step">
            <div class="progress-bar">
                <div class="progress" style="width: 50%"></div>
            </div>
            <div class="step-indicator">Paso 3 de 4</div>

            <button class="btn-back" onclick="goBack()" aria-label="Volver al paso anterior">‚Üê Atr√°s</button>

            <div class="sticky-header">
                <h2>Selecciona tus Productos</h2>
                <div class="order-total-mini">
                    Total: <strong id="total-mini">$0.00</strong>
                </div>
            </div>

            <!-- Promo Code Section -->
            <div class="promo-code-section">
                <div class="promo-code-container" id="promo-code-container">
                    <div class="promo-code-input-group">
                        <span class="promo-icon">üè∑Ô∏è</span>
                        <input type="text"
                               id="promo-code-input"
                               placeholder="C√≥digo promocional"
                               maxlength="6"
                               autocomplete="off"
                               style="text-transform: uppercase;">
                        <button type="button" id="apply-promo-btn" class="btn-apply-promo" onclick="applyPromoCode()">
                            Aplicar
                        </button>
                    </div>
                    <span id="promo-code-message" class="promo-message"></span>
                </div>
                <!-- Applied promo banner (hidden by default) -->
                <div id="promo-applied-banner" class="promo-applied-banner" style="display: none;">
                    <div class="promo-applied-content">
                        <span class="promo-check">‚úì</span>
                        <div class="promo-applied-text">
                            <strong>Descuento Aplicado</strong>
                            <span id="promo-client-name"></span>
                        </div>
                    </div>
                    <button type="button" class="btn-remove-promo" onclick="removePromoCode()">‚úï</button>
                </div>
            </div>

            <!-- #10: Product Search/Filter -->
            <div class="product-search-container">
                <div class="product-search">
                    <svg class="product-search-icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text"
                           id="product-search-input"
                           placeholder="Buscar productos..."
                           autocomplete="off">
                </div>
            </div>

            <div id="products-loading" class="loading">
                <div class="spinner"></div>
                <p>Cargando productos...</p>
            </div>

            <div id="products-container" class="products-grid"></div>

            <!-- Shipping indicator - shows free shipping progress -->
            <div id="shipping-indicator" class="shipping-indicator"></div>

            <div class="sticky-footer">
                <div class="summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <strong id="order-subtotal">$0.00</strong>
                    </div>
                    <div class="summary-row" id="footer-shipping-row">
                        <span>üöö Env√≠o:</span>
                        <strong id="footer-shipping">$0.00</strong>
                    </div>
                    <div class="summary-row total-row">
                        <span>Total:</span>
                        <strong id="order-total">$0.00</strong>
                    </div>
                    <div class="summary-row deposit">
                        <span>Anticipo (50%):</span>
                        <strong id="deposit-amount">$0.00</strong>
                    </div>
                </div>
                <button id="continue-products" class="btn btn-primary btn-large" disabled>
                    Ir al Pago
                </button>
            </div>
        </section>

        <!-- STEP 4: Payment Method -->
        <section id="step-payment" class="step">
            <div class="progress-bar">
                <div class="progress" style="width: 75%"></div>
            </div>
            <div class="step-indicator">Paso 4 de 4</div>

            <button class="btn-back" onclick="goBack()" aria-label="Volver al paso anterior">‚Üê Atr√°s</button>

            <div class="card">
                <h2>M√©todo de Pago</h2>

                <!-- Order Summary - Single unified summary -->
                <div class="order-summary-card">
                    <h3 style="font-size: 16px; margin-bottom: 12px; color: var(--gray-900);">üìã Resumen de tu Pedido</h3>

                    <div id="order-items-summary"></div>

                    <div style="border-top: 2px solid var(--gray-200); margin-top: 16px; padding-top: 16px;">
                        <div class="summary-row" style="margin-bottom: 8px;">
                            <span style="font-size: 15px;">Subtotal:</span>
                            <strong id="summary-subtotal" style="font-size: 15px;">$0.00</strong>
                        </div>
                        <div class="summary-row" style="margin-bottom: 8px;">
                            <span style="font-size: 15px;">üöö Env√≠o:</span>
                            <strong id="summary-shipping" style="font-size: 15px;">$0.00</strong>
                        </div>
                        <div class="summary-row" style="margin-bottom: 12px; padding-top: 8px; border-top: 1px dashed var(--gray-300);">
                            <span style="font-size: 16px; font-weight: 600;">Total:</span>
                            <strong id="summary-total" style="font-size: 16px;">$0.00</strong>
                        </div>
                        <div class="summary-row" style="font-size: 18px; background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(255, 152, 0, 0.1)); padding: 12px; border-radius: 8px;">
                            <span style="font-weight: 600;">üí∞ Anticipo a Pagar (50%):</span>
                            <strong id="summary-deposit" style="color: var(--primary); font-size: 20px;">$0.00</strong>
                        </div>
                    </div>
                </div>

                <!-- Hidden fields to maintain JS compatibility -->
                <input type="hidden" id="payment-total">
                <input type="hidden" id="payment-deposit">
                <input type="hidden" id="summary-total-pay">

                <div class="payment-methods">
                    <label class="payment-option">
                        <input type="radio" name="payment" value="stripe" checked>
                        <div class="payment-card">
                            <div class="payment-icon">üí≥</div>
                            <div class="payment-info">
                                <strong>Tarjeta de Cr√©dito/D√©bito</strong>
                                <p>Pago seguro con Stripe</p>
                            </div>
                        </div>
                    </label>

                    <label class="payment-option">
                        <input type="radio" name="payment" value="bank_transfer">
                        <div class="payment-card">
                            <div class="payment-icon">üè¶</div>
                            <div class="payment-info">
                                <strong>Transferencia Bancaria</strong>
                                <p>Sube tu comprobante de pago</p>
                            </div>
                        </div>
                    </label>
                </div>

                <!-- Notes collapsible (moved here) -->
                <details class="notes-collapsible" style="margin-top: 20px;">
                    <summary class="notes-summary">
                        üìù Agregar notas al pedido (opcional)
                    </summary>
                    <div class="form-group" style="margin-top: 12px;">
                        <textarea id="client-notes"
                                  rows="3"
                                  placeholder="Ej: Necesito que los llaveros tengan el nombre en color azul..."></textarea>
                    </div>
                </details>

                <!-- Stripe Payment Link (shown when card payment selected) -->
                <div id="stripe-payment-link" class="stripe-payment-container" style="margin-top: 20px;">
                    <button type="button" id="stripe-pay-btn" class="btn btn-primary btn-large" style="background: linear-gradient(135deg, #635bff, #4f46e5);">
                        üí≥ Confirmar y Pagar ‚Üí
                    </button>
                    <p style="text-align: center; font-size: 12px; color: var(--gray-600); margin-top: 10px;">
                        üîí Pago seguro con Stripe
                    </p>
                </div>

                <!-- Bank Transfer Details (hidden initially) -->
                <div id="bank-details" class="bank-details hidden">
                    <h3>Datos Bancarios</h3>

                    <!-- SPEI Reference tip -->
                    <div class="spei-tip">
                        <span class="spei-icon">üí°</span>
                        <div>
                            <strong>Tip:</strong> En el concepto/referencia de tu transferencia escribe tu n√∫mero de tel√©fono para identificar tu pago m√°s r√°pido.
                        </div>
                    </div>

                    <p style="font-weight: 600; margin-bottom: 16px;">Opci√≥n 1: Transferencia Bancaria (SPEI)</p>
                    <div class="bank-info">
                        <div class="info-row">
                            <span>Banco:</span>
                            <strong id="bank-name">BBVA</strong>
                        </div>
                        <div class="info-row">
                            <span>Cuenta CLABE:</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <strong id="bank-account">012 180 01571714055 4</strong>
                                <button type="button" class="copy-btn" onclick="copyToClipboard('012180015717140554', this)" aria-label="Copiar n√∫mero de cuenta">
                                    üìã <span class="copy-text">Copiar</span>
                                </button>
                            </div>
                        </div>
                        <div class="info-row">
                            <span>Titular:</span>
                            <strong id="bank-holder">Iv√°n Valencia</strong>
                        </div>
                        <div class="info-row">
                            <span>Monto a depositar:</span>
                            <strong id="bank-amount" class="highlight-amount"></strong>
                        </div>
                    </div>

                    <p style="font-weight: 600; margin: 24px 0 16px;">Opci√≥n 2: Dep√≥sito en Banco/Cajero/Oxxo</p>
                    <div class="bank-info">
                        <div class="info-row">
                            <span>Banco:</span>
                            <strong>BBVA</strong>
                        </div>
                        <div class="info-row">
                            <span>Tarjeta:</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <strong>4152 3138 4049 8567</strong>
                                <button type="button" class="copy-btn" onclick="copyToClipboard('4152313840498567', this)" aria-label="Copiar n√∫mero de tarjeta">
                                    üìã <span class="copy-text">Copiar</span>
                                </button>
                            </div>
                        </div>
                        <div class="info-row">
                            <span>Titular:</span>
                            <strong>Iv√°n Valencia</strong>
                        </div>
                        <div class="info-row">
                            <span>Monto a depositar:</span>
                            <strong id="card-amount" class="highlight-amount"></strong>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Subir Comprobante de Pago</label>
                        <div class="file-upload-area" id="proof-upload-area">
                            <input type="file"
                                   id="payment-proof"
                                   accept="image/*,application/pdf"
                                   hidden>
                            <div class="upload-prompt">
                                <span class="upload-icon">üìÑ</span>
                                <p>Toca para subir comprobante</p>
                                <span class="file-hint">Imagen o PDF</span>
                            </div>
                            <div id="proof-preview" class="file-preview"></div>
                        </div>
                    </div>
                </div>

                <button id="submit-order" class="btn btn-primary btn-large" style="display: none;">
                    <span id="submit-text">‚úÖ Enviar Pedido</span>
                    <span id="submit-loader" class="hidden">
                        <span class="spinner-small"></span> Enviando...
                    </span>
                </button>
            </div>
        </section>

        <!-- STEP 5: Success -->
        <section id="step-success" class="step">
            <div class="success-container">
                <div class="logo" style="margin-bottom: 24px;">
                    <img src="/assets/images/LOGO-03.png" alt="AXKAN Logo" style="height: 100px;">
                </div>
                <div class="success-icon">‚úÖ</div>
                <h2>¬°Pedido Enviado!</h2>

                <div class="success-details">
                    <p class="order-number">
                        Tu n√∫mero de pedido:<br>
                        <strong id="success-order-number"></strong>
                    </p>

                    <!-- #17: Email confirmation preview -->
                    <p id="email-confirmation-notice" class="email-confirmation-notice">
                        Recibir√°s confirmaci√≥n a: <strong id="success-email"></strong>
                    </p>

                    <div class="info-box">
                        <p><strong>¬øQu√© sigue?</strong></p>
                        <ul>
                            <li>‚úì Recibir√°s confirmaci√≥n por correo</li>
                            <li>‚úì Revisaremos tu pedido</li>
                            <li>‚úì Te contactaremos pronto</li>
                        </ul>
                    </div>
                </div>

                <!-- #16: More action buttons -->
                <div class="success-actions">
                    <button onclick="window.location.reload()" class="btn btn-primary btn-large">
                        Hacer Otro Pedido
                    </button>
                    <a href="https://wa.me/5215538253251" target="_blank" class="btn btn-secondary btn-large" style="display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; background: #25D366; border-color: #25D366; color: white;">
                        <span>üí¨</span> WhatsApp Iv√°n
                    </a>
                    <a href="https://wa.me/5215518942408" target="_blank" class="btn btn-secondary btn-large" style="display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; background: #25D366; border-color: #25D366; color: white;">
                        <span>üí¨</span> WhatsApp Daniel
                    </a>
                </div>
            </div>
        </section>

    </div>

    <!-- Client Order Lookup Modal -->
    <div id="client-lookup-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
        <div style="min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px;">
            <div class="card" style="max-width: 600px; width: 100%; margin: 0; position: relative;">
                <button onclick="closeClientLookup()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 32px; cursor: pointer; color: #6b7280; line-height: 1;">√ó</button>

                <h2 style="margin-bottom: 8px;">üìû Buscar Mis Pedidos</h2>
                <p class="help-text" style="margin-bottom: 24px;">Ingresa tu tel√©fono o correo para ver tus pedidos activos</p>

                <div class="form-group">
                    <label for="lookup-phone">Tel√©fono</label>
                    <input type="tel" id="lookup-phone" placeholder="5512345678" maxlength="10">
                </div>

                <div class="form-group">
                    <label for="lookup-email">Correo Electr√≥nico (opcional)</label>
                    <input type="email" id="lookup-email" placeholder="cliente@ejemplo.com">
                </div>

                <button onclick="lookupClientOrders()" class="btn btn-primary btn-large">
                    üîç Buscar Mis Pedidos
                </button>

                <!-- Loading State -->
                <div id="lookup-loading" style="display: none; text-align: center; margin-top: 24px;">
                    <div class="spinner" style="margin: 0 auto;"></div>
                    <p style="margin-top: 12px; color: #6b7280;">Buscando pedidos...</p>
                </div>

                <!-- Results Container -->
                <div id="lookup-results" style="display: none; margin-top: 24px; border-top: 2px solid #e5e7eb; padding-top: 20px;">
                    <h3 style="margin-bottom: 16px; font-size: 18px; color: #111827;">Pedidos Encontrados</h3>
                    <div id="lookup-orders-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/client-order-form/order-form.js"></script>
</body>
</html>
<!-- Trigger Vercel redeploy Sun Dec  7 22:38:36 CST 2025 -->
